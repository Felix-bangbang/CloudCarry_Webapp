{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["// utils/request.js\n\n// 1. 填入云托管环境ID\nconst ENV_ID = 'prod-3gsdhmmz4c25f5b7'; \n// 2. 填入服务名称 (在云托管服务列表里看，一般叫 flask-xxx)\nconst SERVICE_NAME = 'flask-24y5';\n\nconst request = (options) => {\n    return new Promise((resolve, reject) => {\n        // 1. 获取本地 Token\n        const token = uni.getStorageSync('auth_token');\n        \n        // 2. 构造 Header\n        const header = {\n            'Content-Type': 'application/json',\n            'Authorization': token ? `Bearer ${token}` : '',\n            // 这是一个特殊的 Header，告诉云托管即使没有公网域名也要处理请求\n            'X-WX-SERVICE': SERVICE_NAME \n        };\n\n        // 3. 使用微信云托管原生调用 (无需域名)\n        wx.cloud.callContainer({\n            config: {\n                env: ENV_ID // 指定环境\n            },\n            path: options.url, // 接口路径 (例如 /api/posts)\n            header: header,\n            method: options.method || 'GET',\n            data: options.data || {},\n            success: (res) => {\n                // 4. 统一处理状态码\n                if (res.statusCode >= 200 && res.statusCode < 300) {\n                    resolve(res.data);\n                } else if (res.statusCode === 401) {\n                    uni.showToast({ title: '请先登录', icon: 'none' });\n                    reject(res);\n                } else {\n                    uni.showToast({ title: '服务器开小差了', icon: 'none' });\n                    console.error('API Error:', res);\n                    reject(res);\n                }\n            },\n            fail: (err) => {\n                console.error('Network Error:', err);\n                uni.showToast({ title: '网络连接失败', icon: 'none' });\n                reject(err);\n            }\n        });\n    });\n}\n\nexport default request;"],"names":["uni","wx"],"mappings":";;AAGA,MAAM,SAAS;AAEf,MAAM,eAAe;AAEhB,MAAC,UAAU,CAAC,YAAY;AACzB,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AAEpC,UAAM,QAAQA,cAAAA,MAAI,eAAe,YAAY;AAG7C,UAAM,SAAS;AAAA,MACX,gBAAgB;AAAA,MAChB,iBAAiB,QAAQ,UAAU,KAAK,KAAK;AAAA;AAAA,MAE7C,gBAAgB;AAAA,IAC5B;AAGQC,kBAAE,KAAC,MAAM,cAAc;AAAA,MACnB,QAAQ;AAAA,QACJ,KAAK;AAAA;AAAA,MACR;AAAA,MACD,MAAM,QAAQ;AAAA;AAAA,MACd;AAAA,MACA,QAAQ,QAAQ,UAAU;AAAA,MAC1B,MAAM,QAAQ,QAAQ,CAAE;AAAA,MACxB,SAAS,CAAC,QAAQ;AAEd,YAAI,IAAI,cAAc,OAAO,IAAI,aAAa,KAAK;AAC/C,kBAAQ,IAAI,IAAI;AAAA,QACpC,WAA2B,IAAI,eAAe,KAAK;AAC/BD,wBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAM,CAAE;AAC7C,iBAAO,GAAG;AAAA,QAC9B,OAAuB;AACHA,wBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,OAAM,CAAE;AAChDA,wBAAc,MAAA,MAAA,SAAA,0BAAA,cAAc,GAAG;AAC/B,iBAAO,GAAG;AAAA,QACb;AAAA,MACJ;AAAA,MACD,MAAM,CAAC,QAAQ;AACXA,sBAAA,MAAA,MAAA,SAAA,0BAAc,kBAAkB,GAAG;AACnCA,sBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,OAAM,CAAE;AAC/C,eAAO,GAAG;AAAA,MACb;AAAA,IACb,CAAS;AAAA,EACT,CAAK;AACL;;"}