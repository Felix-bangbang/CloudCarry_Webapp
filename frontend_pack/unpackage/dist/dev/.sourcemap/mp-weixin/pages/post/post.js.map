{"version":3,"file":"post.js","sources":["pages/post/post.vue","pages/post/post.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<view class=\"header-title\">\n\t\t\t发布{{ type === 'traveler' ? '出行信息' : '寻捎需求' }}\n\t\t</view>\n\n\t\t<van-cell-group>\n\t\t\t<van-field :value=\"form.origin\" label=\"出发地\" placeholder=\"例如：上海\" @change=\"onInput('origin', $event)\" />\n\t\t\t<van-field :value=\"form.destination\" label=\"目的地\" placeholder=\"例如：伦敦\" @change=\"onInput('destination', $event)\" />\n\t\t\t\n\t\t\t<picker mode=\"date\" :start=\"today\" @change=\"bindDateChange\">\n\t\t\t\t<van-field :value=\"form.date\" label=\"日期\" placeholder=\"点击选择日期\" readonly is-link />\n\t\t\t</picker>\n\n\t\t\t<van-field \n\t\t\t\tv-if=\"type === 'traveler'\"\n\t\t\t\t:value=\"form.capacity\" \n\t\t\t\tlabel=\"可用重量\" \n\t\t\t\tplaceholder=\"例如：1kg\" \n\t\t\t\t@change=\"onInput('capacity', $event)\" \n\t\t\t/>\n\t\t\t<van-field \n\t\t\t\tv-else\n\t\t\t\t:value=\"form.item_desc\" \n\t\t\t\tlabel=\"物品描述\" \n\t\t\t\tplaceholder=\"例如：几件衣服，一双鞋....\" \n\t\t\t\t@change=\"onInput('item_desc', $event)\" \n\t\t\t/>\n\n\t\t\t<van-field \n\t\t\t\t:value=\"form.remark\" \n\t\t\t\tlabel=\"其它要求\" \n\t\t\t\ttype=\"textarea\" \n\t\t\t\tplaceholder=\"请输入备注信息...\" \n\t\t\t\tautosize \n\t\t\t\t@change=\"onInput('remark', $event)\" \n\t\t\t/>\n\t\t</van-cell-group>\n\n\t\t<view style=\"padding: 20px;\">\n\t\t\t<van-button type=\"primary\" color=\"#7dc5eb\" block round @click=\"submit\">确认发布</van-button>\n\t\t</view>\n\t\t<van-toast id=\"van-toast\" />\n\t</view>\n</template>\n\n<script>\n\timport Toast from '/wxcomponents/vant/toast/toast';\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\ttype: 'traveler', // 默认值，通过页面参数修改\n\t\t\t\ttoday: new Date().toISOString().slice(0, 10),\n\t\t\t\tform: { origin: '', destination: '', date: '', capacity: '', item_desc: '', remark: '' }\n\t\t\t}\n\t\t},\n\t\tonLoad(options) {\n\t\t\t// 接收上个页面传来的参数：type='traveler' 或 'sender'\n\t\t\tif (options.type) {\n\t\t\t\tthis.type = options.type;\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tonInput(key, e) { this.form[key] = e.detail; },\n\t\t\tbindDateChange(e) { this.form.date = e.detail.value; },\n\t\t\tsubmit() {\n\t\t\t\t// 简单的非空校验\n\t\t\t\tif(!this.form.origin || !this.form.destination || !this.form.date) {\n\t\t\t\t\tToast.fail('请完善核心信息');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// 权限校验：必须完善信息才能发布\n\t\t\t\tconst myInfo = uni.getStorageSync('user_profile');\n\t\t\t\tif(!myInfo || !myInfo.wechat) {\n\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\ttitle:'提示', content:'请先去[我的]页面完善微信号',\n\t\t\t\t\t\tsuccess: (res) => { if(res.confirm) uni.switchTab({url:'/pages/profile/profile'}) }\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tuni.showLoading({ title: '发布中...' });\n\n\t\t\t\tconst postData = {\n\t\t\t\t\ttype: this.type, // 'traveler' 或 'sender'\n\t\t\t\t\torigin: this.form.origin,\n\t\t\t\t\tdestination: this.form.destination,\n\t\t\t\t\tdate: this.form.date,\n\t\t\t\t\t// 如果是旅行者传 capacity，如果是云捎传 item_desc\n\t\t\t\t\tcapacity: this.type === 'traveler' ? this.form.capacity : null,\n\t\t\t\t\titem_desc: this.type === 'sender' ? this.form.item_desc : null,\n\t\t\t\t\tremark: this.form.remark\n\t\t\t\t};\n\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: '/api/posts',\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tdata: postData\n\t\t\t\t}).then(res => {\n\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\tuni.showToast({ title: '发布成功' });\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t// 返回上一页并自动刷新\n\t\t\t\t\t\tuni.navigateBack(); \n\t\t\t\t\t}, 1500);\n\t\t\t\t}).catch(err => {\n\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t// 如果触发了内容安全拦截 (msgSecCheck)\n\t\t\t\t\tuni.showToast({ title: '发布失败：内容可能包含违规词', icon: 'none' });\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\t.container { background-color: #f7f8fa; min-height: 100vh; padding-top: 10px; }\n\t.header-title { padding: 15px; font-size: 20px; font-weight: bold; color: #333; text-align: center;}\n</style>","import MiniProgramPage from '/Users/fvinci6/Documents/HBuilderProjects/CloudCarry/frontend_pack/pages/post/post.vue'\nwx.createPage(MiniProgramPage)"],"names":["Toast","uni"],"mappings":";;;AAgDC,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,MAAM;AAAA;AAAA,MACN,QAAO,oBAAI,QAAO,YAAa,EAAC,MAAM,GAAG,EAAE;AAAA,MAC3C,MAAM,EAAE,QAAQ,IAAI,aAAa,IAAI,MAAM,IAAI,UAAU,IAAI,WAAW,IAAI,QAAQ,GAAG;AAAA,IACxF;AAAA,EACA;AAAA,EACD,OAAO,SAAS;AAEf,QAAI,QAAQ,MAAM;AACjB,WAAK,OAAO,QAAQ;AAAA,IACrB;AAAA,EACA;AAAA,EACD,SAAS;AAAA,IACR,QAAQ,KAAK,GAAG;AAAE,WAAK,KAAK,GAAG,IAAI,EAAE;AAAA,IAAS;AAAA,IAC9C,eAAe,GAAG;AAAE,WAAK,KAAK,OAAO,EAAE,OAAO;AAAA,IAAQ;AAAA,IACtD,SAAS;AAER,UAAG,CAAC,KAAK,KAAK,UAAU,CAAC,KAAK,KAAK,eAAe,CAAC,KAAK,KAAK,MAAM;AAClEA,4CAAM,KAAK,SAAS;AACpB;AAAA,MACD;AAEA,YAAM,SAASC,cAAAA,MAAI,eAAe,cAAc;AAChD,UAAG,CAAC,UAAU,CAAC,OAAO,QAAQ;AAC7BA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAM;AAAA,UAAM,SAAQ;AAAA,UACpB,SAAS,CAAC,QAAQ;AAAE,gBAAG,IAAI;AAASA,4BAAG,MAAC,UAAU,EAAC,KAAI,yBAAwB,CAAC;AAAA,UAAE;AAAA,QACnF,CAAC;AACD;AAAA,MACD;AACAA,oBAAAA,MAAI,YAAY,EAAE,OAAO,SAAU,CAAA;AAEnC,YAAM,WAAW;AAAA,QAChB,MAAM,KAAK;AAAA;AAAA,QACX,QAAQ,KAAK,KAAK;AAAA,QAClB,aAAa,KAAK,KAAK;AAAA,QACvB,MAAM,KAAK,KAAK;AAAA;AAAA,QAEhB,UAAU,KAAK,SAAS,aAAa,KAAK,KAAK,WAAW;AAAA,QAC1D,WAAW,KAAK,SAAS,WAAW,KAAK,KAAK,YAAY;AAAA,QAC1D,QAAQ,KAAK,KAAK;AAAA;AAGnB,WAAK,MAAM;AAAA,QACV,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,MAAM;AAAA,OACN,EAAE,KAAK,SAAO;AACdA,sBAAG,MAAC,YAAW;AACfA,sBAAAA,MAAI,UAAU,EAAE,OAAO,OAAQ,CAAA;AAC/B,mBAAW,MAAM;AAEhBA,wBAAG,MAAC,aAAY;AAAA,QAChB,GAAE,IAAI;AAAA,MACR,CAAC,EAAE,MAAM,SAAO;AACfA,sBAAG,MAAC,YAAW;AAEfA,sBAAG,MAAC,UAAU,EAAE,OAAO,kBAAkB,MAAM,OAAO,CAAC;AAAA,MACxD,CAAC;AAAA,IACF;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9GD,GAAG,WAAW,eAAe;"}