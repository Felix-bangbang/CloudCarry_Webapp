{"version":3,"file":"profile.js","sources":["pages/profile/profile.vue","pages/profile/profile.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<view class=\"user-header\">\n\t\t\t<button class=\"avatar-wrapper\" open-type=\"chooseAvatar\" @chooseavatar=\"onChooseAvatar\">\n\t\t\t\t<image class=\"avatar-img\" :src=\"profile.avatar || defaultAvatar\"></image>\n\t\t\t</button>\n\t\t\t\n\t\t\t<input \n\t\t\t\ttype=\"nickname\" \n\t\t\t\tclass=\"nick-name-input\" \n\t\t\t\t:value=\"profile.nickname\" \n\t\t\t\tplaceholder=\"点击设置昵称\" \n\t\t\t\t@change=\"onNicknameChange\"\n\t\t\t\t@blur=\"onNicknameChange\"\n\t\t\t/>\n\t\t</view>\n\n\t\t<view class=\"form-area\">\n\t\t\t<view class=\"section-title\">个人信息</view>\n\t\t\t<view class=\"desc-text\">完善主页后，方可发布信息。</view>\n\t\t\t\n\t\t\t<van-cell-group>\n\t\t\t\t<van-field\n\t\t\t\t\t:value=\"profile.wechat\"\n\t\t\t\t\tlabel=\"微信号\"\n\t\t\t\t\tplaceholder=\"请输入您的微信号\"\n\t\t\t\t\t@change=\"onWechatInput\"\n\t\t\t\t/>\n\t\t\t\t<van-field\n\t\t\t\t\t:value=\"profile.phone\"\n\t\t\t\t\tlabel=\"手机号\"\n\t\t\t\t\tplaceholder=\"选填\"\n\t\t\t\t\t@change=\"onPhoneInput\"\n\t\t\t\t/>\n\t\t\t</van-cell-group>\n\n\t\t\t<view style=\"padding: 20px; margin-top: 20px;\">\n\t\t\t\t<van-button type=\"info\" color=\"#7dc5eb\" block round @click=\"saveProfile\">保存修改</van-button>\n\t\t\t\t\n\t\t\t\t<button open-type=\"feedback\" class=\"feedback-btn\">反馈</button>\n\t\t\t</view>\n\t\t\t\n\t\t</view>\n\t\t\n\t\t<van-toast id=\"van-toast\" />\n\t</view>\n</template>\n\n<script>\n\timport Toast from '/wxcomponents/vant/toast/toast';\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\t// 默认灰色头像\n\t\t\t\tdefaultAvatar: 'https://mmbiz.qpic.cn/mmbiz/icTdbqWNOwNRna42FI242Lcia07jQodd2SJPGic3TB3C3uhG7uP629BTf20F-ExeFAb/0', \n\t\t\t\tprofile: { \n\t\t\t\t\twechat: '', \n\t\t\t\t\tphone: '',\n\t\t\t\t\tavatar: '',   \n\t\t\t\t\tnickname: ''  \n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonShow() {\n\t\t    const saved = uni.getStorageSync('user_profile');\n\t\t    if(saved) {\n\t\t        this.profile = { \n\t\t            ...this.profile, \n\t\t            ...saved,\n\t\t            // 强制把 null 转为空字符串\n\t\t            wechat: saved.wechat || '', \n\t\t            phone: saved.phone || '',\n\t\t            nickname: saved.nickname || '',\n\t\t            avatar: saved.avatar || ''\n\t\t        };\n\t\t    }\n\t\t},\n\t\t\n\t\tmethods: {\n\t\t\tonWechatInput(e) { this.profile.wechat = e.detail; },\n\t\t\tonPhoneInput(e) { this.profile.phone = e.detail; },\n\t\t\t\n\t\t\t// 1. 处理头像 (只存本地临时路径)\n\t\t\tonChooseAvatar(e) {\n\t\t\t\tconst { avatarUrl } = e.detail;\n\t\t\t\tthis.profile.avatar = avatarUrl; \n\t\t\t},\n\t\t\t\n\t\t\t// 2. 处理昵称 (只存本地)\n\t\t\tonNicknameChange(e) {\n\t\t\t\tthis.profile.nickname = e.detail.value;\n\t\t\t},\n\n\t\t\tsaveProfile() {\n\t\t\t\tif(!this.profile.wechat) {\n\t\t\t\t\tuni.showToast({ title: '微信号不能为空', icon: 'none' });\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 3. 发送给后端的只有 wechat 和 phone\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: '/api/user/profile',\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tcontact_wechat: this.profile.wechat,\n\t\t\t\t\t\tcontact_phone: this.profile.phone\n\t\t\t\t\t}\n\t\t\t\t}).then(res => {\n\t\t\t\t\t// 4. 保存成功后，将所有数据（包括没发给后端的头像昵称）存入本地缓存\n\t\t\t\t\t// 这样用户下次进来，依然能看到自己设置的头像\n\t\t\t\t\tuni.setStorageSync('user_profile', this.profile);\n\t\t\t\t\t\n\t\t\t\t\tuni.showToast({ title: '保存成功' });\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tuni.showToast({ title: '保存失败', icon: 'none' });\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\t.container { background-color: #f7f8fa; min-height: 100vh; }\n\t.user-header { background-color: #ffffff; padding: 30px; text-align: center; margin-bottom: 10px; }\n\t\n\t/* 头像样式 */\n\t.avatar-wrapper {\n\t\tpadding: 0;\n\t\twidth: 80px !important; \n\t\theight: 80px !important;\n\t\tborder-radius: 50%;\n\t\tmargin: 0 auto 10px;\n\t\tbackground: #eee;\n\t\tborder: none;\n\t\toverflow: hidden;\n\t}\n\t.avatar-wrapper::after { border: none; }\n\t.avatar-img { width: 100%; height: 100%; }\n\t\n\t/* 昵称样式 */\n\t.nick-name-input {\n\t\tfont-size: 18px;\n\t\tfont-weight: bold;\n\t\tcolor: #333;\n\t\ttext-align: center;\n\t\theight: 40px;\n\t\tline-height: 40px;\n\t}\n\n\t.form-area { background-color: #ffffff; padding: 20px;}\n\t.section-title { \n\t\tfont-size: 16px; font-weight: bold; \n\t\tmargin-bottom: 5px; border-left: 4px solid #7dc5eb; padding-left: 10px;}\n\t.desc-text { font-size: 12px; color: #999; margin-bottom: 15px; padding-left: 14px; }\n\t\n\t/* --- 意见反馈按钮样式 --- */\n\t.feedback-btn {\n\t\tmargin-top: 20px;\n\t\tbackground-color: #7dc5eb;\n\t\tcolor: white;\n\t\tborder-radius: 999px;\n\t\tborder: none;\n\t\t\n\t\t/* 强制不加粗，字号对齐 */\n\t\tfont-weight: 400 !important; \n\t\tfont-size: 14px !important; /* Vant 普通按钮通常是 14-16px */\n\t\t\n\t\t/* 高度与 Vant 对齐 */\n\t\theight: 44px;\n\t\tline-height: 44px;\n\t\t\n\t\t/* 宽度略小 */\n\t\twidth: 48%;\n\t\tdisplay: block;\n\t\tmargin-left: auto;\n\t\tmargin-right: auto;\n\t}\n\t\n\t/* 移除点击态背景变黑 */\n\t.feedback-btn::after { border: none; }\n</style>","import MiniProgramPage from '/Users/fvinci6/Documents/HBuilderProjects/CloudCarry/frontend_pack/pages/profile/profile.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;;AAkDC,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA;AAAA,MAEN,eAAe;AAAA,MACf,SAAS;AAAA,QACR,QAAQ;AAAA,QACR,OAAO;AAAA,QACP,QAAQ;AAAA,QACR,UAAU;AAAA,MACX;AAAA,IACD;AAAA,EACA;AAAA,EACD,SAAS;AACL,UAAM,QAAQA,cAAAA,MAAI,eAAe,cAAc;AAC/C,QAAG,OAAO;AACN,WAAK,UAAU;AAAA,QACX,GAAG,KAAK;AAAA,QACR,GAAG;AAAA;AAAA,QAEH,QAAQ,MAAM,UAAU;AAAA,QACxB,OAAO,MAAM,SAAS;AAAA,QACtB,UAAU,MAAM,YAAY;AAAA,QAC5B,QAAQ,MAAM,UAAU;AAAA;IAEhC;AAAA,EACH;AAAA,EAED,SAAS;AAAA,IACR,cAAc,GAAG;AAAE,WAAK,QAAQ,SAAS,EAAE;AAAA,IAAS;AAAA,IACpD,aAAa,GAAG;AAAE,WAAK,QAAQ,QAAQ,EAAE;AAAA,IAAS;AAAA;AAAA,IAGlD,eAAe,GAAG;AACjB,YAAM,EAAE,UAAQ,IAAM,EAAE;AACxB,WAAK,QAAQ,SAAS;AAAA,IACtB;AAAA;AAAA,IAGD,iBAAiB,GAAG;AACnB,WAAK,QAAQ,WAAW,EAAE,OAAO;AAAA,IACjC;AAAA,IAED,cAAc;AACb,UAAG,CAAC,KAAK,QAAQ,QAAQ;AACxBA,sBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,OAAK,CAAG;AAChD;AAAA,MACD;AAGA,WAAK,MAAM;AAAA,QACV,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,gBAAgB,KAAK,QAAQ;AAAA,UAC7B,eAAe,KAAK,QAAQ;AAAA,QAC7B;AAAA,OACA,EAAE,KAAK,SAAO;AAGdA,sBAAAA,MAAI,eAAe,gBAAgB,KAAK,OAAO;AAE/CA,sBAAAA,MAAI,UAAU,EAAE,OAAO,OAAQ,CAAA;AAAA,OAC/B,EAAE,MAAM,MAAM;AACdA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAK,CAAG;AAAA,MAC9C,CAAC;AAAA,IACF;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrHD,GAAG,WAAW,eAAe;"}