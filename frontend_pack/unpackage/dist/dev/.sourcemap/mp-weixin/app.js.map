{"version":3,"file":"app.js","sources":["App.vue","main.js"],"sourcesContent":["<script>\n\texport default {\n\t\tonLaunch: function() {\n\t\t\t\t// 新增：初始化云开发\n\t\t\t\tif (wx.cloud) {\n\t\t\t\t\t\twx.cloud.init({\n\t\t\t\t\t\t\t\tenv: 'prod-3gsdhmmz4c25f5b7', // 填环境ID\n\t\t\t\t\t\t\t\ttraceUser: true\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t// 检查本地有没有 Token\n\t\t\tconst token = uni.getStorageSync('auth_token');\n\t\t\tif (!token) {\n\t\t\t\t// 没有 Token，执行静默登录\n\t\t\t\tthis.doLogin();\n\t\t\t} else {\n\t\t\t\t// 有 Token，检查是否过期（可选，这里为了简化先不做）\n\t\t\t\tconsole.log('已登录');\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tdoLogin() {\n\t\t\t\tuni.login({\n\t\t\t\t\tprovider: 'weixin',\n\t\t\t\t\tsuccess: (loginRes) => {\n\t\t\t\t\t\t// 发送 code 给后端\n\t\t\t\t\t\tthis.$http({\n\t\t\t\t\t\t\turl: '/api/auth/login',\n\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\tdata: { code: loginRes.code }\n\t\t\t\t\t\t}).then(res => {\n\t\t\t\t\t\t\t// 存 Token 和 用户信息\n\t\t\t\t\t\t\tuni.setStorageSync('auth_token', res.token);\n\t\t\t\t\t\t\t// 后端返回的 user 包含 {id, wechat, phone}\n\t\t\t\t\t\t\tuni.setStorageSync('user_profile', res.user);\n\t\t\t\t\t\t\tconsole.log('登录成功', res.user);\n\t\t\t\t\t\t}).catch(err => {\n\t\t\t\t\t\t\tconsole.error('登录失败', err);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n</script>\r\n\r\n<style>\r\n\t/*每个页面公共css */\r\n</style>\n","import App from './App'\n\n// 从 'vue' 中引入 createSSRApp\nimport { createSSRApp } from 'vue'\n// 引入封装好的请求工具\nimport request from './utils/request.js'\n\nexport function createApp() {\n  const app = createSSRApp(App)\n  \n  // 挂载全局请求方法\n  app.config.globalProperties.$http = request\n  \n  return {\n    app\n  }\n}"],"names":["wx","uni","createSSRApp","App","request"],"mappings":";;;;;;;;;;;AACC,MAAK,YAAU;AAAA,EACd,UAAU,WAAW;AAEnB,QAAIA,cAAAA,KAAG,OAAO;AACZA,oBAAE,KAAC,MAAM,KAAK;AAAA,QACZ,KAAK;AAAA;AAAA,QACL,WAAW;AAAA,MACb,CAAC;AAAA,IACH;AAED,UAAM,QAAQC,cAAAA,MAAI,eAAe,YAAY;AAC7C,QAAI,CAAC,OAAO;AAEX,WAAK,QAAO;AAAA,WACN;AAENA,oBAAAA,MAAY,MAAA,OAAA,iBAAA,KAAK;AAAA,IAClB;AAAA,EACA;AAAA,EACD,SAAS;AAAA,IACR,UAAU;AACTA,oBAAAA,MAAI,MAAM;AAAA,QACT,UAAU;AAAA,QACV,SAAS,CAAC,aAAa;AAEtB,eAAK,MAAM;AAAA,YACV,KAAK;AAAA,YACL,QAAQ;AAAA,YACR,MAAM,EAAE,MAAM,SAAS,KAAK;AAAA,WAC5B,EAAE,KAAK,SAAO;AAEdA,0BAAAA,MAAI,eAAe,cAAc,IAAI,KAAK;AAE1CA,0BAAAA,MAAI,eAAe,gBAAgB,IAAI,IAAI;AAC3CA,0BAAY,MAAA,MAAA,OAAA,iBAAA,QAAQ,IAAI,IAAI;AAAA,UAC7B,CAAC,EAAE,MAAM,SAAO;AACfA,gEAAc,QAAQ,GAAG;AAAA,UAC1B,CAAC;AAAA,QACF;AAAA,MACD,CAAC;AAAA,IACF;AAAA,EACD;AACD;ACpCM,SAAS,YAAY;AAC1B,QAAM,MAAMC,cAAY,aAACC,SAAG;AAG5B,MAAI,OAAO,iBAAiB,QAAQC,cAAO;AAE3C,SAAO;AAAA,IACL;AAAA,EACD;AACH;AACA,YAAY,IAAI,MAAM,MAAM;;"}